<!DOCTYPE html>
<html>
<head>
<title>デモンストレーション</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="css/ui-lightness/jquery-ui-1.10.3.custom.css" type="text/css">

<!--
テキストボックスのStyle設定
-->
<style>
.textbox {
  background: white;
  border: 1px solid #DDD;
  border-radius: 5px;
  box-shadow: 0 0 5px #DDD inset;
  color: #666;
  outline: none;
  height:25px;
  width: 275px;
}
</style>

<!--
ボタンのStyle設定
-->
<style type="text/css">
.css_btn_class {
  font-size:12px;
  font-family:Arial;
  font-weight:normal;
  -moz-border-radius:8px;
  -webkit-border-radius:8px;
  border-radius:8px;
  border:1px solid #3866a3;
  padding:5px 18px;
  text-decoration:none;
  background:-webkit-gradient( linear, left top, left bottom, color-stop(5%, #63b8ee), color-stop(100%, #468ccf) );
  background:-moz-linear-gradient( center top, #63b8ee 5%, #468ccf 100% );
  background:-ms-linear-gradient( top, #63b8ee 5%, #468ccf 100% );
  filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#63b8ee', endColorstr='#468ccf');
  background-color:#63b8ee;
  color:#ffffff;
  display:inline-block;
  text-shadow:1px 1px 0px #7cacde;
  -webkit-box-shadow:inset 1px 1px 0px 0px #bee2f9;
  -moz-box-shadow:inset 1px 1px 0px 0px #bee2f9;
  box-shadow:inset 1px 1px 0px 0px #bee2f9;
}.css_btn_class:hover {
  background:-webkit-gradient( linear, left top, left bottom, color-stop(5%, #468ccf), color-stop(100%, #63b8ee) );
  background:-moz-linear-gradient( center top, #468ccf 5%, #63b8ee 100% );
  background:-ms-linear-gradient( top, #468ccf 5%, #63b8ee 100% );
  filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#468ccf', endColorstr='#63b8ee');
  background-color:#468ccf;
}.css_btn_class:active {
  position:relative;
  top:1px;
}
/* This css button was generated by http://html-generator.weebly.com */
</style>

<script type="text/javascript" src="js/jquery-1.9.1.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.10.3.custom.js"></script>

<script type="text/javascript" charset="utf-8" src="http://js.api.olp.yahooapis.jp/OpenLocalPlatform/V1/jsapi?appid=dj0zaiZpPXNpcGFoeXE2c2FiYiZzPWNvbnN1bWVyc2VjcmV0Jng9YzE-"></script>

<!--
地図検索
-->
<script language="JavaScript"><!--
var collection = "station";
var rows = 10;

$(function(){
  var ymap = new Y.Map("map");
  ymap.drawMap(new Y.LatLng(35.66572, 139.73100), 15, Y.LayerSetId.NORMAL);

  var control = new Y.SliderZoomControlVertical();
  ymap.addControl(control);

  $(window).bind("resize", function(e){
    ymap.updateSize();
  });

  var markers = new Array(0);
  var labels = new Array(0);

  $("#search").click(function() {
    $.ajax({
      async: false,
      url: "/solr/" + collection + "/select",
      type: "GET",
      cache: false,
      dataType: "json",
      data: {'q':$("#query").val(), 'q.op':'AND', 'start':0, 'rows':rows, 'df':'station_name', 'fq':'{!geofilt}', 'sort':'geodist() asc', 'pt':ymap.getCenter().lat() + "," + ymap.getCenter().lng(), 'sfield':'latlon', 'd':20, wt:'json'},
      success: function(msg, textStatus) {
        for (marker of markers) {
          if (marker) {
            ymap.removeFeature(marker);
          }
        }
        for (label of labels) {
          if (label) {
            ymap.removeFeature(label);
          }
        }

        var docs = msg.response.docs;

        markers = new Array(docs.length);
        labels = new Array(docs.length);

        for (var i = 0; i < docs.length; i++) {
          markers[i] = new Y.Marker(new Y.LatLng(docs[i].lat, docs[i].lon));
          labels[i]  = new Y.Label(new Y.LatLng(docs[i].lat, docs[i].lon), docs[i].station_name);

          ymap.addFeature(markers[i]);
          ymap.addFeature(labels[i]);
        }
      },
      error: function(xhr, ts, err){
        //$("#spell_dym").html("&nbsp;");
      }
    });
  });
});
</script>

</head>

<body>
<div class="query-box">
  <input style="font-size: 12pt;" class="textbox" type="text" id="query" name="q" value="*:*" autocomplete="off"/>
  <input class="css_btn_class" type="button" id="search" name="search" value="Search"/>
</div>

<div id="map" style="width:100%; height:600px;"></div>
<!--
<div id="map" style="width:100%; height:100%"></div>
-->

</body>
</html>
